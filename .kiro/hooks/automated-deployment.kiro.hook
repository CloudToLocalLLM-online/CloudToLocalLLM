{
  "enabled": true,
  "name": "Automated Deployment Workflow",
  "description": "Triggers the complete CloudToLocalLLM deployment workflow from Windows development environment to Linux VPS. Orchestrates version management, Flutter builds, VPS deployment, and verification with comprehensive error handling and rollback capabilities.",
  "version": "1.0.0",
  "when": {
    "type": "fileEdited",
    "displayName": "Deploy to VPS",
    "icon": "rocket",
    "category": "Deployment"
  },
  "then": {
    "type": "executeScript",
    "script": {
      "command": "powershell.exe",
      "args": [
        "-ExecutionPolicy",
        "Bypass",
        "-NoProfile",
        "-File",
        "scripts/powershell/Deploy-CloudToLocalLLM.ps1",
        "-Environment",
        "{{environment}}",
        "-VersionIncrement",
        "{{versionIncrement}}",
        "-Force",
        "-AutoRollback",
        "-Verbose"
      ],
      "workingDirectory": ".",
      "timeout": 1800,
      "killSignal": "SIGTERM",
      "encoding": "utf8"
    },
    "parameters": [
      {
        "name": "environment",
        "displayName": "Deployment Environment",
        "description": "Target environment for deployment",
        "type": "select",
        "required": true,
        "default": "Production",
        "options": [
          {
            "label": "Production",
            "value": "Production",
            "description": "Deploy to production VPS"
          },
          {
            "label": "Staging",
            "value": "Staging",
            "description": "Deploy to staging environment"
          },
          {
            "label": "Local",
            "value": "Local",
            "description": "Deploy to local development environment"
          }
        ]
      },
      {
        "name": "versionIncrement",
        "displayName": "Version Increment",
        "description": "Type of version increment to apply",
        "type": "select",
        "required": true,
        "default": "build",
        "options": [
          {
            "label": "Build (x.x.x.BUILD)",
            "value": "build",
            "description": "Increment build number for routine deployments"
          },
          {
            "label": "Patch (x.x.PATCH.x)",
            "value": "patch",
            "description": "Increment patch version for bug fixes"
          },
          {
            "label": "Minor (x.MINOR.x.x)",
            "value": "minor",
            "description": "Increment minor version for new features"
          },
          {
            "label": "Major (MAJOR.x.x.x)",
            "value": "major",
            "description": "Increment major version for breaking changes"
          }
        ]
      }
    ],
    "outputHandling": {
      "streamOutput": true,
      "captureStdout": true,
      "captureStderr": true,
      "logLevel": "info",
      "progressIndicators": [
        {
          "pattern": "\\[INFO\\]\\s+(.+)",
          "type": "info",
          "extractMessage": true
        },
        {
          "pattern": "\\[SUCCESS\\]\\s+(.+)",
          "type": "success",
          "extractMessage": true
        },
        {
          "pattern": "\\[WARNING\\]\\s+(.+)",
          "type": "warning",
          "extractMessage": true
        },
        {
          "pattern": "\\[ERROR\\]\\s+(.+)",
          "type": "error",
          "extractMessage": true
        },
        {
          "pattern": "Phase:\\s+(.+)",
          "type": "phase",
          "extractMessage": true
        },
        {
          "pattern": "Progress:\\s+(\\d+)%",
          "type": "progress",
          "extractProgress": true
        }
      ]
    },
    "errorHandling": {
      "retryCount": 0,
      "retryDelay": 0,
      "failureActions": [
        {
          "condition": "exitCode != 0",
          "action": "showError",
          "message": "Deployment failed. Check the output for details and consider manual rollback if needed."
        }
      ]
    },
    "notifications": {
      "onStart": {
        "enabled": true,
        "message": "Starting CloudToLocalLLM deployment to {{environment}}..."
      },
      "onSuccess": {
        "enabled": true,
        "message": "Deployment to {{environment}} completed successfully!"
      },
      "onFailure": {
        "enabled": true,
        "message": "Deployment to {{environment}} failed. Check logs for details."
      }
    }
  },
  "requirements": {
    "platform": [
      "windows"
    ],
    "dependencies": [
      {
        "name": "PowerShell",
        "version": ">=5.1",
        "description": "PowerShell 5.1 or later required for script execution"
      },
      {
        "name": "WSL2",
        "description": "Windows Subsystem for Linux 2 with Ubuntu 24.04"
      },
      {
        "name": "Flutter SDK",
        "description": "Flutter SDK installed in WSL environment"
      },
      {
        "name": "SSH Access",
        "description": "SSH key-based access to target VPS configured"
      },
      {
        "name": "Git",
        "description": "Git repository with proper remote configuration"
      }
    ]
  },
  "metadata": {
    "author": "CloudToLocalLLM Development Team",
    "created": "2025-01-18",
    "tags": [
      "deployment",
      "automation",
      "vps",
      "flutter",
      "powershell"
    ],
    "documentation": "docs/DEPLOYMENT/automated-deployment-workflow.md"
  }
}