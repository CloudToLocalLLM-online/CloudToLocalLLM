# ============================================================================
# Runtime Dockerfile for CloudToLocalLLM Streaming Proxy
# Uses artifacts from the Universal Builder
# ============================================================================

# Use custom Fedora base (cloudtolocalllm/base:latest)
FROM cloudtolocalllm/base:latest

# Switch to root to install Node.js
USER root
RUN dnf -y install nodejs npm && \
    dnf clean all

WORKDIR /app

# Copy artifacts (node_modules + code) from local filesystem
# Ensure ownership by cloudtolocalllm
COPY --chown=cloudtolocalllm:cloudtolocalllm services/streaming-proxy/node_modules ./node_modules
COPY --chown=cloudtolocalllm:cloudtolocalllm services/streaming-proxy/ .

# Switch to non-root user
USER cloudtolocalllm

EXPOSE 8081
CMD [ "node", "dist/main.js" ]
