# Flatpak Manifest for CloudToLocalLLM
# This file defines how to build and package CloudToLocalLLM as a Flatpak
#
# To enable Linux builds:
# 1. Uncomment the Linux build configuration in .github/workflows/build-release.yml
# 2. Add Linux-specific build steps to install Flatpak tools
# 3. Update the build workflow to use this manifest
#
# For more information:
# - Flatpak documentation: https://docs.flatpak.org/
# - Flutter Linux deployment: https://docs.flutter.dev/deployment/linux

app-id: com.cloudtolocalllm.CloudToLocalLLM
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: cloudtolocalllm

finish-args:
  # Allow access to X11 and Wayland for GUI
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  
  # Allow GPU acceleration
  - --device=dri
  
  # Allow network access for API calls
  - --share=network
  
  # Allow access to home directory for configuration
  - --filesystem=home
  
  # Allow access to system bus for desktop integration
  - --socket=session-bus
  
  # Allow access to sound (if needed for notifications)
  - --socket=pulseaudio

modules:
  - name: cloudtolocalllm
    buildsystem: simple
    build-commands:
      # Copy the Flutter build output to the Flatpak app directory
      - install -Dm755 cloudtolocalllm /app/bin/cloudtolocalllm
      
      # Copy all required libraries and data files
      - cp -r lib /app/
      - cp -r data /app/
      
      # Install desktop file for application menu integration
      - install -Dm644 com.cloudtolocalllm.CloudToLocalLLM.desktop /app/share/applications/com.cloudtolocalllm.CloudToLocalLLM.desktop
      
      # Install application icon
      - install -Dm644 assets/images/app_icon.png /app/share/icons/hicolor/256x256/apps/com.cloudtolocalllm.CloudToLocalLLM.png
      
      # Install AppStream metadata for software centers
      - install -Dm644 com.cloudtolocalllm.CloudToLocalLLM.metainfo.xml /app/share/metainfo/com.cloudtolocalllm.CloudToLocalLLM.metainfo.xml
    
    sources:
      # Source directory containing the Flutter Linux build output
      - type: dir
        path: build/linux/x64/release/bundle
      
      # Desktop file for application menu
      - type: file
        path: linux/com.cloudtolocalllm.CloudToLocalLLM.desktop
      
      # AppStream metadata
      - type: file
        path: linux/com.cloudtolocalllm.CloudToLocalLLM.metainfo.xml

# Additional modules can be added here for dependencies not provided by the runtime
# For example, if CloudToLocalLLM requires specific libraries:
# 
# - name: custom-library
#   buildsystem: cmake
#   sources:
#     - type: archive
#       url: https://example.com/library.tar.gz
#       sha256: <checksum>
