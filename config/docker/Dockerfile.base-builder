# Base Builder Image for CloudToLocalLLM
# Inherits from our custom base (Fedora + cloudtolocalllm user)

FROM cloudtolocalllm/base:latest

# Switch to root for installation
USER root

# Install Base Tools
RUN dnf -y update && \
    dnf -y install git curl wget unzip which xz make gcc-c++ && \
    dnf clean all

# Install Java (for Android/Flutter tools)
# Fedora Rawhide likely moved to Java 21+
RUN dnf -y install java-21-openjdk-devel && \
    dnf clean all

# Install Node.js and NPM
RUN dnf -y install nodejs npm && \
    dnf clean all

# Install Flutter SDK
# We install it to /opt/flutter and give ownership to 'cloudtolocalllm'
ENV FLUTTER_ROOT=/opt/flutter
RUN mkdir -p $FLUTTER_ROOT && \
    chown -R cloudtolocalllm:cloudtolocalllm $FLUTTER_ROOT

# Switch back to non-root user
USER cloudtolocalllm
WORKDIR /home/cloudtolocalllm

# Download and extract Flutter SDK
# Using stable channel
RUN git clone https://github.com/flutter/flutter.git -b stable $FLUTTER_ROOT

# Add Flutter to PATH
ENV PATH="$FLUTTER_ROOT/bin:$FLUTTER_ROOT/bin/cache/dart-sdk/bin:$PATH"

# Pre-download Flutter artifacts
RUN flutter doctor

# Verify installations
RUN node --version && \
    npm --version && \
    flutter --version

WORKDIR /app
