# Base Builder Image for CloudToLocalLLM
# Contains Flutter SDK, Node.js, and build tools.
# Based on Fedora 41 (Stable).

FROM fedora:41

# Install Base Tools
RUN dnf -y update && \
    dnf -y install git curl wget unzip which xz make gcc-c++ && \
    dnf clean all

# Install Java (for Android/Flutter tools)
RUN dnf -y install java-17-openjdk-devel && \
    dnf clean all

# Install Node.js and NPM
RUN dnf -y install nodejs npm && \
    dnf clean all

# Create non-root user 'builder' (UID 1000)
RUN useradd -u 1000 -m -s /bin/bash builder

# Install Flutter SDK
# We install it to /opt/flutter and give ownership to 'builder'
ENV FLUTTER_ROOT=/opt/flutter
RUN mkdir -p $FLUTTER_ROOT && \
    chown -R builder:builder $FLUTTER_ROOT

USER builder
WORKDIR /home/builder

# Download and extract Flutter SDK
# Using stable channel
RUN git clone https://github.com/flutter/flutter.git -b stable $FLUTTER_ROOT

# Add Flutter to PATH
ENV PATH="$FLUTTER_ROOT/bin:$FLUTTER_ROOT/bin/cache/dart-sdk/bin:$PATH"

# Pre-download Flutter artifacts
RUN flutter doctor

# Verify installations
RUN node --version && \
    npm --version && \
    flutter --version

WORKDIR /app
