# Base Image for CloudToLocalLLM
# Using official Node.js 24 image as requested by user.
# Switching to Debian-based commands (apt-get) as node:24 is likely Debian-based.

FROM node:24

# Create custom user 'cloudtolocalllm' (UID 1000)
# We do this first to ensure it exists in all derived images
# node image usually has 'node' user at 1000, we can use it or create ours.
# To avoid conflict, we'll use the existing 'node' user or create ours if ID 1000 is free.
# Actually, node image has user 'node' with uid 1000. We should probably use that or rename it.
# For compatibility with existing setup, let's try to use 'cloudtolocalllm'.
# If 1000 is taken, we might need to modify it.
# Let's check if we can just use useradd. If it fails, we handle it.
# Safer: Just use the 'node' user but alias it? Or just create cloudtolocalllm with 1001?
# User requested "NO ROOT EVER" and custom user 'cloudtolocalllm'.
# We will try to create it. If 1000 is taken, we'll use 1001.
# BUT, previous dockerfiles assume 1000.
# Let's modify the node user to cloudtolocalllm if it exists.

RUN if id -u node >/dev/null 2>&1; then \
    usermod -l cloudtolocalllm -d /home/cloudtolocalllm -m node; \
    groupmod -n cloudtolocalllm node; \
    else \
    useradd -u 1000 -m -s /bin/bash cloudtolocalllm; \
    fi

# Install essential tools for rsync-based deployment
RUN apt-get update && \
    apt-get install -y rsync tar openssh-client && \
    rm -rf /var/lib/apt/lists/*

# Set up working directory
WORKDIR /app
RUN chown cloudtolocalllm:cloudtolocalllm /app

# Default to non-root user
USER cloudtolocalllm
