---
# Service Account for web application
apiVersion: v1
kind: ServiceAccount
metadata:
  name: web-sa
  namespace: cloudtolocalllm
  labels:
    app: web
    component: frontend

---
# Service Account for API backend
apiVersion: v1
kind: ServiceAccount
metadata:
  name: api-backend-sa
  namespace: cloudtolocalllm
  labels:
    app: api-backend
    component: backend

---
# Service Account for PostgreSQL
apiVersion: v1
kind: ServiceAccount
metadata:
  name: postgres-sa
  namespace: cloudtolocalllm
  labels:
    app: postgres
    component: database

---
# Role for web application (read-only access to ConfigMaps and Secrets)
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: web-role
  namespace: cloudtolocalllm
  labels:
    app: web
rules:
  # Read ConfigMaps for application configuration
  - apiGroups: [""]
    resources: ["configmaps"]
    verbs: ["get", "list", "watch"]
  # Read Secrets for sensitive data
  - apiGroups: [""]
    resources: ["secrets"]
    verbs: ["get", "list"]
  # Read Services for service discovery
  - apiGroups: [""]
    resources: ["services"]
    verbs: ["get", "list", "watch"]
  # Read Endpoints for service discovery
  - apiGroups: [""]
    resources: ["endpoints"]
    verbs: ["get", "list", "watch"]

---
# Role for API backend (read/write access to ConfigMaps and Secrets)
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: api-backend-role
  namespace: cloudtolocalllm
  labels:
    app: api-backend
rules:
  # Read ConfigMaps for application configuration
  - apiGroups: [""]
    resources: ["configmaps"]
    verbs: ["get", "list", "watch"]
  # Read Secrets for sensitive data
  - apiGroups: [""]
    resources: ["secrets"]
    verbs: ["get", "list"]
  # Read Services for service discovery
  - apiGroups: [""]
    resources: ["services"]
    verbs: ["get", "list", "watch"]
  # Read Endpoints for service discovery
  - apiGroups: [""]
    resources: ["endpoints"]
    verbs: ["get", "list", "watch"]
  # Read Pods for pod discovery
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["get", "list", "watch"]

---
# Role for PostgreSQL (read-only access to ConfigMaps and Secrets)
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: postgres-role
  namespace: cloudtolocalllm
  labels:
    app: postgres
rules:
  # Read ConfigMaps for database configuration
  - apiGroups: [""]
    resources: ["configmaps"]
    verbs: ["get", "list", "watch"]
  # Read Secrets for database credentials
  - apiGroups: [""]
    resources: ["secrets"]
    verbs: ["get", "list"]

---
# RoleBinding for web application
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: web-rolebinding
  namespace: cloudtolocalllm
  labels:
    app: web
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: web-role
subjects:
  - kind: ServiceAccount
    name: web-sa
    namespace: cloudtolocalllm

---
# RoleBinding for API backend
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: api-backend-rolebinding
  namespace: cloudtolocalllm
  labels:
    app: api-backend
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: api-backend-role
subjects:
  - kind: ServiceAccount
    name: api-backend-sa
    namespace: cloudtolocalllm

---
# RoleBinding for PostgreSQL
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: postgres-rolebinding
  namespace: cloudtolocalllm
  labels:
    app: postgres
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: postgres-role
subjects:
  - kind: ServiceAccount
    name: postgres-sa
    namespace: cloudtolocalllm
