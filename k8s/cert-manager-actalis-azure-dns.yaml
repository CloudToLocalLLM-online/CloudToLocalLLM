# cert-manager ClusterIssuer using Actalis with Azure DNS-01 challenge
# Actalis (formerly Actalis ACME) offers unlimited free certificates via ACME
#
# Benefits:
# - Unlimited free certificates
# - 90-day certificate validity
# - European-based CA
# - No EAB required
# - Works with existing Azure DNS setup
#
# Prerequisites:
# 1. Actalis account: https://www.actalis.com/ (sign up for free)
# 2. Create ACME account in Actalis dashboard
# 3. Azure DNS zone: cloudtolocalllm.online
# 4. Service Principal with DNS Zone Contributor role on the DNS zone
# 5. Kubernetes secret: azure-dns-config (already exists from main setup)

apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: actalis-prod
spec:
  acme:
    # Actalis ACME server (DV90 = Domain Validated, 90-day certificates)
    server: https://acme.actalis.it/v2/DV90
    email: admin@cloudtolocalllm.online

    privateKeySecretRef:
      name: actalis-prod-key

    # Use DNS-01 challenge with Azure DNS for domain validation
    solvers:
      - dns01:
          azureDNS:
            # Azure service principal credentials from existing secret
            # The secret contains: client-id, client-secret, subscription-id, tenant-id
            clientID: <AZURE_CLIENT_ID>  # Replace in workflow or manually
            clientSecretSecretRef:
              name: azure-dns-config
              key: client-secret
            subscriptionID: <AZURE_SUBSCRIPTION_ID>  # Replace in workflow or manually
            tenantID: <AZURE_TENANT_ID>  # Replace in workflow or manually
            resourceGroupName: cloudtolocalllm-rg
            hostedZoneName: cloudtolocalllm.online
            environment: AzurePublicCloud
