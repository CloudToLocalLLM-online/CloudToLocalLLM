# cert-manager ClusterIssuer using HiCA with Azure DNS-01 challenge
# ⚠️ ISSUES: HiCA ACME server endpoint may not be available (returns 404)
# HiCA also requires acme.sh client specifically and may not work with cert-manager
# Consider using SSL.com or Actalis instead
#
# HiCA offers free SSL certificates with simple ACME setup (no account required)
#
# Benefits:
# - Free certificates
# - No account creation required
# - 180-day certificate validity
#
# Limitations:
# - ⚠️ Requires acme.sh client (may not work with cert-manager)
# - ⚠️ ACME endpoint may be unavailable (acme.hi.cn/directory returns 404)
# - ⚠️ Chinese CA - may have trust/accessibility issues
#
# Prerequisites:
# 1. Azure DNS zone: cloudtolocalllm.online
# 2. Service Principal with DNS Zone Contributor role on the DNS zone
# 3. Kubernetes secret: azure-dns-config (already exists from main setup)

apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: hica-prod
spec:
  acme:
    # HiCA ACME server
    server: https://acme.hi.cn/directory
    email: admin@cloudtolocalllm.online

    privateKeySecretRef:
      name: hica-prod-key

    # Use DNS-01 challenge with Azure DNS for domain validation
    solvers:
      - dns01:
          azureDNS:
            # Azure service principal credentials from existing secret
            # The secret contains: client-id, client-secret, subscription-id, tenant-id
            clientID: <AZURE_CLIENT_ID>  # Replace in workflow or manually
            clientSecretSecretRef:
              name: azure-dns-config
              key: client-secret
            subscriptionID: <AZURE_SUBSCRIPTION_ID>  # Replace in workflow or manually
            tenantID: <AZURE_TENANT_ID>  # Replace in workflow or manually
            resourceGroupName: cloudtolocalllm-rg
            hostedZoneName: cloudtolocalllm.online
            environment: AzurePublicCloud
