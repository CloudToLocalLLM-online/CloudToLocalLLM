# cert-manager ClusterIssuer using Cloudflare DNS-01 challenge
# This uses Cloudflare DNS for automatic SSL certificate provisioning
#
# Benefits:
# - Works with any ACME CA (Let's Encrypt, ZeroSSL, SSL.com, etc.)
# - Automatic certificate provisioning and renewal
# - Wildcard certificate support
# - No need to expose HTTP-01 challenge endpoints
#
# Prerequisites:
# 1. Cloudflare account with API token
# 2. Cloudflare DNS zone: cloudtolocalllm.online
# 3. Cloudflare API token with DNS:Edit permissions
# 4. Kubernetes secret: cloudflare-api-token (created in workflow)

apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: cloudflare-dns-staging
spec:
  acme:
    # Let's Encrypt Staging (for testing)
    server: https://acme-staging-v02.api.letsencrypt.org/directory
    email: admin@cloudtolocalllm.online
    
    privateKeySecretRef:
      name: cloudflare-dns-staging-key
    
    # Use DNS-01 challenge with Cloudflare DNS for domain validation
    solvers:
      - dns01:
          cloudflare:
            # Cloudflare API token from Kubernetes secret
            apiTokenSecretRef:
              name: cloudflare-api-token
              key: api-token

---
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: cloudflare-dns-prod
spec:
  acme:
    # Let's Encrypt Production
    server: https://acme-v02.api.letsencrypt.org/directory
    email: admin@cloudtolocalllm.online
    
    privateKeySecretRef:
      name: cloudflare-dns-prod-key
    
    # Use DNS-01 challenge with Cloudflare DNS for domain validation
    solvers:
      - dns01:
          cloudflare:
            # Cloudflare API token from Kubernetes secret
            apiTokenSecretRef:
              name: cloudflare-api-token
              key: api-token

